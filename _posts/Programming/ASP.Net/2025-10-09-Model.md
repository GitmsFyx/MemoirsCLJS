---
categories: ASP.net
---

# Model

模型绑定,框架功能,自动提供

## 框架自动获得参数

简化得到参数的过程,  
不必`ControllerContext.HttpContext.Request.RouteValues["id"]`

```C#
//设置路由参数
[Route("store/books/{id}")]
//设置参数
public ActionResult Books(int id)
{
    //框架会将URL的参数传入id
    return Content($"<h1>Book Store {id}</h1>");
}
```
### 明确数据源

```C#
[Route("store/books/{id}")]
//只从路由中获得参数.
//还有[FromQuery].
public ActionResult Books([FromRoute]int id)
{

    return Content($"<h1>Book Store {id}</h1>");
}
```

## 模型绑定

Model 类
```C#
public class Book
{
    public int BookId { get; set; }
    public string? Author { get; set; }

    public override string ToString()
    {
        return $"BookId: {BookId}, Author: {Author}";
    }
}
```

控制器方法

```C#
[Route("bookstore/{bookid?}/{isloggedin?}")]
//这里的Book的bookid会被填充,由路由参数或查询语句相同的变量填充,大小写不敏感
//如果Book前面添加[FromQuery],那么它只会被查询语句填充.
public IActionResult BookStore([FromQuery]int? bookid,[FromRoute]bool? isloggedin,Book book)
{

    return RedirectToAction("Books","Store",new {});
}
```

为Book不同属性设定来源

```C#
public class Book
{
    [FromQuery]
    public int BookId { get; set; }
    [FromRoute]
    public string? Author { get; set; }

    public override string ToString()
    {
        return $"BookId: {BookId}, Author: {Author}";
    }
}
```

------------------

验证规则

`using System.ComponentModel.DataAnnotations;`

```C#
public class Person
{
    //必须提供
    [Required]
    public string? PersonName { get; set; } 
    public string? Email { get; set; }
    //设置错误信息
    [Required(ErrorMessage = "No Phone")]
    public string? Phone { get; set; }
    public string? Password { get; set; }
    public string? ConfirmPassword { get; set; }
    public double? Price { get; set; }
    
    public override string ToString()
    {
        return $"PersonName: {PersonName}, Email: {Email}, Phone: {Phone}, Password: {Password}, ConfirmPassword: {ConfirmPassword}, Price: {Price}";
    }
}
```

`ModelState` 控制器里面的属性,包含以下属性:
- `IsValid` Ture表示没有验证错误
- `Values` 所有提供的值
- `ErrorCount` 错误数量

```C#
    public class HomeController : Controller
    {
        // GET: HomeController
        [Route("register")]
        public IActionResult Index(Person person)
        {
            if (!ModelState.IsValid)
            {
                string errors =
                    string.Join("\n",
                    ModelState.Values.SelectMany(value => value.Errors)
                    .Select(error => error.ErrorMessage).ToList());
                /*
                foreach (var value in ModelState.Values)
                {
                    foreach (var error in value.Errors)
                    {
                        errorsList.Add(error.ErrorMessage);
                    }
                }*/
                return BadRequest($"{errors}");
            }
            
            return Ok(person.ToString());
            
        }

    }
```


## 表单 post

### form-urlencoded(default)

处理少量信息

*Request Headers* : 
    
    Content-Type:application/x-www-form-urlencoded

*Request Body* : 
    
    param1=value&param2=value2

### form-data

处理大量信息时候使用,**可以添加附件文件**

*Request Headers* : 
    
    Content-Type:multipart/form-data

*Request Body* : 

    -------随机字符
    Content-Disposition:
    value1

